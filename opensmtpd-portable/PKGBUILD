# Hugo Osvaldo Barrera <hugo@osvaldobarrera.com.ar>

pkgname=opensmtpd-portable
_pkgname=opensmtpd
pkgver=201301191220
_openbsdver=5.2.x
pkgrel=1
pkgdesc='A FREE implementation of the server-side SMTP protocol'
arch=('i686' 'x86_64')
url="http://www.opensmtpd.org/portable.html"
license=('BSD')
conflicts=('sendmail' 'postfix' 'opensmtpd')
provides=('opensmtpd')
options=(!strip)
backup=("etc/smtpd.conf")
source=(http://www.opensmtpd.org/archives/${_pkgname}-${pkgver}p1.tar.gz
        smtpd.rc
	smtpd.service
	bootstrap.patch)
md5sums=('a3a409abb6053dc4a2e3c32849716b0e'
         '6c0093d42aa11b58670d0bbef069a64c'
         '636da7986f5ec40b80e72b71a6a7ac59'
         '7acd426a6fd836335a127712aee68676')
install="${pkgname}.install"

build() {
  export LDFLAGS="-lrt -Wl,-O1,--sort-common,--as-needed,-z,relro"

  cd "${srcdir}/${_pkgname}"-${_openbsdver}p1

  patch -p1 < ../bootstrap.patch

  ./bootstrap
  ./configure --prefix=/usr --sysconfdir=/etc

  make
}

package() {
  install -Dm 755 smtpd.rc ${pkgdir}/etc/rc.d/smtpd
  install -Dm 644 smtpd.service ${pkgdir}/usr/lib/systemd/system/smtpd.service
  cd "$srcdir/$_pkgname"-${_openbsdver}p1
  make DESTDIR="${pkgdir}/" install
}

