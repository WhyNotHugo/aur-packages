# Maintainer Brad Arrington

pkgname=opensmtpd-portable
_pkgname=opensmtpd
pkgver=201207111000
pkgrel=1
pkgdesc='A FREE implementation of the server-side SMTP protocol'
arch=('i686' 'x86_64')
url="http://www.opensmtpd.org/portable.html"
license=('BSD')
conflicts=('sendmail' 'postfix' 'opensmtpd')
provides=('opensmtpd')
options=(!strip)
backup=("etc/mail/smtpd.conf")
source=(http://www.opensmtpd.org/archives/${_pkgname}-${pkgver}.tar.gz
	bootstrap.patch
        smtpd.rc)
md5sums=('9b0328521293540fcee34718bf7df848'
         'aa56e5586f1e5a8bb0a919ea8e66984c'
         '6c0093d42aa11b58670d0bbef069a64c')

build() {
  export LDFLAGS="-lrt -Wl,-O1,--sort-common,--as-needed,-z,relro"

  cd "$srcdir/$_pkgname"

  patch -p1 < $srcdir/bootstrap.patch 

  ./bootstrap
  ./configure --prefix=/usr --sysconfdir=/etc

  make
}

package() {
  install -Dm 755 smtpd.rc $pkgdir/etc/rc.d/smtpd
  cd "$srcdir/$_pkgname"
  make DESTDIR="$pkgdir/" install
}

